@startuml
skinparam monochrome true
skinparam defaultTextAlignment center

rectangle "~/.mcp-central/config/mcp-servers.json" as CENTRAL
rectangle "mcp-auto-sync.py\n(~/.mcp-central/bin)" as SYNC

CENTRAL -down-> SYNC : 单一来源
CENTRAL -right-> MCP : 按客户端落地
rectangle "mcp\nstatus/apply-cli/run/ide-all" as MCP

package "目标配置 (仅写 MCP 段)" {
  rectangle "Codex\n~/.codex/config.toml\n[mcp_servers.*]" as CODEX
  rectangle "Gemini\n~/.gemini/settings.json\nmcpServers + mcp.allowed" as GEMINI
  rectangle "iFlow\n~/.iflow/settings.json\nmcpServers" as IFLOW
  rectangle "Claude(文件)\n~/.claude/settings.json\nmcpServers" as CLAUDE_FILE
  rectangle "Cursor\n~/.cursor/mcp.json\nmcpServers" as CURSOR
  rectangle "VS Code\n~/.config/Code/User/mcp.json\nservers" as VSCODE
  rectangle "Droid\n~/.factory/mcp.json\nmcpServers" as DROID
}

SYNC -down-> CODEX
SYNC -down-> GEMINI
SYNC -down-> IFLOW
SYNC -down-> CLAUDE_FILE
SYNC -down-> CURSOR
SYNC -down-> VSCODE
SYNC -down-> DROID
MCP -down-> CODEX
MCP -down-> GEMINI
MCP -down-> IFLOW
MCP -down-> CLAUDE_FILE
MCP -down-> CURSOR
MCP -down-> VSCODE
MCP -down-> DROID

rectangle "Claude(注册表)\nclaude mcp add/remove\n(~/.claude.json 项目作用域)" as CLAUDE_REG
SYNC -right-> CLAUDE_REG : 兜底注册

cloud "运行时（stdio）" as RUNTIME
CODEX -down-> RUNTIME
GEMINI -down-> RUNTIME
IFLOW -down-> RUNTIME
CLAUDE_REG -down-> RUNTIME
CURSOR -down-> RUNTIME
VSCODE -down-> RUNTIME
DROID -down-> RUNTIME

package "MCP Servers (本机)" {
  rectangle "chrome-devtools\ncommand: npx\nargs: -y chrome-devtools-mcp@latest" as CDT
  rectangle "playwright\ncommand: npx\nargs: -y @playwright/mcp@latest" as PW
  rectangle "filesystem\ncommand: npx\nargs: -y mcp-server-filesystem@latest" as FS
  rectangle "sequential-thinking\ncommand: npx\nargs: -y @modelcontextprotocol/server-sequential-thinking@latest" as ST
  rectangle "codex-cli\ncommand: npx\nargs: -y @cexll/codex-mcp-server@latest" as CMC
  rectangle "context7\ncommand: npx\nargs: -y @upstash/context7-mcp@latest" as CTX7
  rectangle "task-master-ai\ncommand: npx\nargs: -y task-master-ai@latest" as TMA
  rectangle "serena\n~/.local/bin/serena start-mcp-server" as SERENA
}

RUNTIME -down-> CDT
RUNTIME -down-> PW
RUNTIME -down-> FS
RUNTIME -down-> ST
RUNTIME -down-> CMC
  RUNTIME -down-> CTX7
  RUNTIME -down-> TMA
  RUNTIME -down-> SERENA

rectangle "可选(默认禁用)\nchrome-devtools-local\n--browserUrl http://127.0.0.1:9222" as CDT_LOCAL #DDDDDD
RUNTIME -down-> CDT_LOCAL

note bottom of CDT
  官方推荐用 npx，使用 @latest 始终保持最新
  避免 latest 带来不兼容
end note

note right of CLAUDE_REG
  环境变量必须位于：
  name 之后、-- 之前
  例如：
  claude mcp add --transport stdio name \
    -e KEY=VAL -- command args
end note

@enduml
